{"ast":null,"code":"import _asyncToGenerator from\"C:/workspaces/atom_workspace/sesh-chatchat/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/workspaces/atom_workspace/sesh-chatchat/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\workspaces\\\\atom_workspace\\\\sesh-chatchat\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React,{useState,useEffect,useRef}from\"react\";import{useLocation}from\"react-router-dom\";import{logout}from\"../helpers/auth\";import{authService,database,database_ref}from\"../services/firebase\";import{sendChat,getChats,getAddedChats}from\"../helpers/database\";import useNotification from\"../helpers/useNotification\";import\"../chat.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function useQuery(){var _useLocation=useLocation(),search=_useLocation.search;return React.useMemo(function(){return new URLSearchParams(search);},[search]);}function Chat(){var startAdd=false;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),msg=_useState2[0],setMsg=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),chats=_useState4[0],setChats=_useState4[1];var setChatList=function setChatList(chatList,isInitEnd){var themeData=getThemeData();var myList=function myList(){if(themeData.theme==\"light\"){var list=chatList.map(function(chat,index){return/*#__PURE__*/_jsxs(\"li\",{className:chat.uid===authService.currentUser.uid?\"right\":\"left\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"time\",children:/*#__PURE__*/_jsx(\"span\",{children:toDate(chat.timestamp)})},createItem(index+\"time\")),/*#__PURE__*/_jsx(\"div\",{className:\"sender\",children:/*#__PURE__*/_jsx(\"span\",{children:chat.email})},createItem(index+\"sender\")),/*#__PURE__*/_jsx(\"div\",{className:\"message\",children:chat.message.split('\\n').map(function(line){return/*#__PURE__*/_jsxs(\"span\",{children:[line,/*#__PURE__*/_jsx(\"br\",{})]},createItem(index+\"span\"));})},createItem(index+\"message\"))]},createItem(index+\"li\"));});return/*#__PURE__*/_jsx(\"ul\",{children:list});}else{var _list=chatList.map(function(chat,index){return/*#__PURE__*/_jsxs(\"li\",{className:chat.uid===authService.currentUser.uid?\"right\":\"left\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"sender\",children:/*#__PURE__*/_jsx(\"span\",{children:\"C:\\\\Users\\\\\"+chat.email})},createItem(index+\"sender\")),/*#__PURE__*/_jsx(\"div\",{className:\"time\",children:/*#__PURE__*/_jsx(\"span\",{children:toDate(chat.timestamp)+\" >\"})},createItem(index+\"time\")),/*#__PURE__*/_jsx(\"div\",{className:\"message\",children:chat.message.split('\\n').map(function(line){return/*#__PURE__*/_jsxs(\"span\",{children:[line,/*#__PURE__*/_jsx(\"br\",{})]},createItem(index+\"span\"));})},createItem(index+\"message\"))]},createItem(index+\"li\"));});return/*#__PURE__*/_jsx(\"ul\",{children:_list});}};setChats(myList);var focused=document.hasFocus();if(!focused&&startAdd){notify(chatList);}if(isInitEnd)startAdd=true;setTimeout(function(){scrollToBottom();},200);};var getThemeData=function getThemeData(){var chatWrap=document.querySelector(\".chat_wrap\");var theme=chatWrap.getAttribute(\"user-theme\");return{'chatWrap':chatWrap,'theme':theme};};var notify=function notify(chatList){if(chatList.length>0){var chat=chatList[chatList.length-1];if(chat.uid!==authService.currentUser.uid){useNotification('SESH',{body:''});// useNotification(chat.email, {\n//   body: `${chat.message}`\n// });\n}}};var sendMsg=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e,msg){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(msg.trim()!==\"\")){_context.next=9;break;}_context.prev=1;_context.next=4;return sendChat(roomName,{uid:authService.currentUser.uid,email:authService.currentUser.email,// message: msg.replaceAll(/(\\n|\\r\\n)/g, \"<br>\"),\nmessage:msg,timestamp:Date.now()}).then(function(){setMsg(\"\");scrollToBottom();});case 4:_context.next=9;break;case 6:_context.prev=6;_context.t0=_context[\"catch\"](1);console.log(_context.t0);case 9:case\"end\":return _context.stop();}}},_callee,null,[[1,6]]);}));return function sendMsg(_x,_x2){return _ref.apply(this,arguments);};}();// USE EFFECT  ---------------------------------------\nuseEffect(function(){try{getAddedChats(roomName,setChatList);}catch(error){console.log(error);}},[]);// HANDLE  -------------------------------------------\nvar handleSendMsg=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:sendMsg(e,msg);case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function handleSendMsg(_x3){return _ref2.apply(this,arguments);};}();var handleLogOut=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return logout();case 3:_context3.next=8;break;case 5:_context3.prev=5;_context3.t0=_context3[\"catch\"](0);console.log(_context3.t0);case 8:case\"end\":return _context3.stop();}}},_callee3,null,[[0,5]]);}));return function handleLogOut(){return _ref3.apply(this,arguments);};}();var handleOnChange=function handleOnChange(e){setMsg(e.target.value);};var handleKeyPress=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(e){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(e.key=='Enter'){if(!e.shiftKey){sendMsg(e,msg);}}case 1:case\"end\":return _context4.stop();}}},_callee4);}));return function handleKeyPress(_x4){return _ref4.apply(this,arguments);};}();var handleModal=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(e){var modeBtn,themeData,chatWrap,theme;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:modeBtn=document.getElementById(\"modeBtn\");themeData=getThemeData();chatWrap=themeData.chatWrap;theme=themeData.theme;if(theme==\"light\"){chatWrap.setAttribute(\"user-theme\",\"dark\");modeBtn.innerText=\"LIGHT\";}else{chatWrap.setAttribute(\"user-theme\",\"light\");modeBtn.innerText=\"DARK\";}getAddedChats(roomName,setChatList);case 6:case\"end\":return _context5.stop();}}},_callee5);}));return function handleModal(_x5){return _ref5.apply(this,arguments);};}();// ETC ----------------------------------------------\nvar query=useQuery();var roomName=query.get(\"room\");var scrollRef=useRef();var scrollToBottom=function scrollToBottom(){scrollRef.current.scrollIntoView({behavior:'smooth',block:'end',inline:'nearest'});};var itemId=1;var createItem=function createItem(text){return itemId++ +text;};var toDate=function toDate(timestamp){//let date = new Intl.DateTimeFormat('ko-KR', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit' }).format(timestamp);\nvar date=new Intl.DateTimeFormat('ko-KR',{hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:false}).format(timestamp);return date;};// --------------------------------------------------\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"chat_wrap\",ref:scrollRef,\"user-theme\":\"light\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"header\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"mode\",type:\"button\",id:\"modeBtn\",value:\"\",onClick:handleModal,children:\"DARK\"}),/*#__PURE__*/_jsx(\"div\",{className:\"title\",children:\"SESH\"}),/*#__PURE__*/_jsx(\"button\",{className:\"logout\",type:\"button\",onClick:handleLogOut,children:\"LOGOUT\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"chat\",children:chats}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-div\",onKeyPress:handleKeyPress,children:[/*#__PURE__*/_jsx(\"textarea\",{className:\"input-msg\",value:msg,placeholder:\"Message Here.\",onChange:handleOnChange}),/*#__PURE__*/_jsx(\"button\",{className:\"send\",type:\"button\",onClick:handleSendMsg,children:\"SEND\"})]})]});}export default Chat;","map":{"version":3,"sources":["C:/workspaces/atom_workspace/sesh-chatchat/src/pages/Chat.js"],"names":["React","useState","useEffect","useRef","useLocation","logout","authService","database","database_ref","sendChat","getChats","getAddedChats","useNotification","useQuery","search","useMemo","URLSearchParams","Chat","startAdd","msg","setMsg","chats","setChats","setChatList","chatList","isInitEnd","themeData","getThemeData","myList","theme","list","map","chat","index","uid","currentUser","toDate","timestamp","createItem","email","message","split","line","focused","document","hasFocus","notify","setTimeout","scrollToBottom","chatWrap","querySelector","getAttribute","length","body","sendMsg","e","trim","roomName","Date","now","then","console","log","error","handleSendMsg","handleLogOut","handleOnChange","target","value","handleKeyPress","key","shiftKey","handleModal","modeBtn","getElementById","setAttribute","innerText","query","get","scrollRef","current","scrollIntoView","behavior","block","inline","itemId","text","date","Intl","DateTimeFormat","hour","minute","second","hour12","format"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\r\nimport { useLocation } from \"react-router-dom\";\r\nimport { logout } from \"../helpers/auth\";\r\nimport { authService, database, database_ref } from \"../services/firebase\";\r\nimport { sendChat, getChats, getAddedChats } from \"../helpers/database\";\r\nimport useNotification from \"../helpers/useNotification\";\r\nimport \"../chat.css\";\r\n\r\nfunction useQuery() {\r\n  const { search } = useLocation();\r\n  return React.useMemo(() => new URLSearchParams(search), [search]);\r\n}\r\n\r\nfunction Chat() {\r\n\r\n  let startAdd = false;\r\n  const [msg, setMsg] = useState(\"\");\r\n  const [chats, setChats] = useState(\"\");\r\n\r\n  const setChatList = (chatList, isInitEnd) => {\r\n    const themeData = getThemeData();\r\n    const myList = () => {\r\n      if(themeData.theme == \"light\") {\r\n        const list = chatList.map((chat, index) => (\r\n          <li key={createItem(index+\"li\")} className={chat.uid === authService.currentUser.uid ? \"right\" : \"left\"}>\r\n            <div key={createItem(index+\"time\")} className = \"time\"><span>{toDate(chat.timestamp)}</span></div>\r\n            <div key={createItem(index+\"sender\")} className = \"sender\"><span>{chat.email}</span></div>\r\n            <div key={createItem(index+\"message\")} className = \"message\">\r\n              {chat.message.split('\\n').map( line => {\r\n                return (<span key={createItem(index+\"span\")}>{line}<br/></span>)\r\n               })}\r\n            </div>\r\n          </li>\r\n        ));\r\n        return <ul>{list}</ul>;\r\n      }else {\r\n        const list = chatList.map((chat, index) => (\r\n          <li key={createItem(index+\"li\")} className={chat.uid === authService.currentUser.uid ? \"right\" : \"left\"}>\r\n            <div key={createItem(index+\"sender\")} className = \"sender\"><span>{\"C:\\\\Users\\\\\"+chat.email}</span></div>\r\n            <div key={createItem(index+\"time\")} className = \"time\"><span>{toDate(chat.timestamp)+\" >\"}</span></div>\r\n            <div key={createItem(index+\"message\")} className = \"message\">\r\n              {chat.message.split('\\n').map( line => {\r\n                return (<span key={createItem(index+\"span\")}>{line}<br/></span>)\r\n               })}\r\n            </div>\r\n          </li>\r\n        ));\r\n        return <ul>{list}</ul>;\r\n      }\r\n    }\r\n    setChats(myList);\r\n\r\n    const focused = document.hasFocus();\r\n    if(!focused && startAdd) {\r\n      notify(chatList);\r\n    }\r\n    if(isInitEnd) startAdd = true;\r\n\r\n    setTimeout(()=>{ scrollToBottom() }, 200);\r\n\r\n  };\r\n\r\n  const getThemeData = () => {\r\n    const chatWrap = document.querySelector(\".chat_wrap\")\r\n    const theme = chatWrap.getAttribute(\"user-theme\");\r\n    return {'chatWrap': chatWrap, 'theme': theme};\r\n  };\r\n\r\n  const notify = (chatList) => {\r\n    if(chatList.length > 0) {\r\n      const chat = chatList[chatList.length-1];\r\n      if(chat.uid !== authService.currentUser.uid) {\r\n        useNotification('SESH', {\r\n          body: ''\r\n        });\r\n        // useNotification(chat.email, {\r\n        //   body: `${chat.message}`\r\n        // });\r\n      }\r\n    }\r\n  }\r\n\r\n  const sendMsg = async (e, msg) => {\r\n    if(msg.trim() !== \"\") {\r\n      try {\r\n        await sendChat(roomName,\r\n        {\r\n          uid: authService.currentUser.uid,\r\n          email: authService.currentUser.email,\r\n          // message: msg.replaceAll(/(\\n|\\r\\n)/g, \"<br>\"),\r\n          message: msg,\r\n          timestamp: Date.now()\r\n        }).then(() => {\r\n          setMsg(\"\");\r\n          scrollToBottom();\r\n        });\r\n      } catch (error) {\r\n        console.log(error);\r\n      }\r\n    }\r\n  }\r\n\r\n// USE EFFECT  ---------------------------------------\r\n  useEffect(() => {\r\n    try {\r\n      getAddedChats(roomName, setChatList);\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  }, []);\r\n\r\n\r\n// HANDLE  -------------------------------------------\r\n  const handleSendMsg = async (e) => {\r\n    sendMsg(e, msg);\r\n  };\r\n\r\n  const handleLogOut = async () => {\r\n    try {\r\n      await logout();\r\n    } catch (error) {\r\n     console.log(error);\r\n    }\r\n  };\r\n\r\n  const handleOnChange = (e) => {\r\n    setMsg(e.target.value);\r\n  };\r\n\r\n\r\n  const handleKeyPress = async(e) => {\r\n    if(e.key == 'Enter') {\r\n      if(!e.shiftKey) {\r\n        sendMsg(e, msg);\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  const handleModal = async(e) => {\r\n    const modeBtn = document.getElementById(\"modeBtn\");\r\n    const themeData = getThemeData();\r\n    const chatWrap = themeData.chatWrap;\r\n    const theme = themeData.theme;\r\n    if(theme == \"light\") {\r\n      chatWrap.setAttribute(\"user-theme\", \"dark\")\r\n      modeBtn.innerText = \"LIGHT\"\r\n    }else {\r\n      chatWrap.setAttribute(\"user-theme\", \"light\")\r\n      modeBtn.innerText = \"DARK\"\r\n    }\r\n    getAddedChats(roomName, setChatList);\r\n  }\r\n\r\n\r\n// ETC ----------------------------------------------\r\n  let query = useQuery();\r\n  const roomName = query.get(\"room\")\r\n\r\n  const scrollRef = useRef();\r\n  const scrollToBottom = () => {\r\n    scrollRef.current.scrollIntoView({ behavior: 'smooth', block: 'end', inline: 'nearest' })\r\n  }\r\n\r\n  let itemId = 1;\r\n  const createItem = (text) => {\r\n    return (itemId++) + text;\r\n  }\r\n\r\n  const toDate = (timestamp) => {\r\n    //let date = new Intl.DateTimeFormat('ko-KR', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit' }).format(timestamp);\r\n    let date = new Intl.DateTimeFormat('ko-KR', {  hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false }).format(timestamp);\r\n    return date;\r\n  }\r\n// --------------------------------------------------\r\n\r\n  return (\r\n\r\n    <div className=\"chat_wrap\" ref={scrollRef} user-theme=\"light\">\r\n      <div className=\"header\">\r\n        <button\r\n          className=\"mode\"\r\n          type=\"button\"\r\n          id=\"modeBtn\"\r\n          value=\"\"\r\n          onClick={handleModal}>\r\n          DARK\r\n        </button>\r\n        <div className=\"title\">SESH</div>\r\n        <button\r\n          className=\"logout\"\r\n          type=\"button\"\r\n          onClick={handleLogOut}>\r\n          LOGOUT\r\n        </button>\r\n      </div>\r\n      <div className=\"chat\">\r\n        {chats}\r\n      </div>\r\n      <div className=\"input-div\" onKeyPress={handleKeyPress}>\r\n        <textarea\r\n          className=\"input-msg\"\r\n          value={msg}\r\n          placeholder=\"Message Here.\"\r\n          onChange={handleOnChange}>\r\n        </textarea>\r\n        <button\r\n          className=\"send\"\r\n          type=\"button\"\r\n          onClick={handleSendMsg}>\r\n          SEND\r\n        </button>\r\n      </div>\r\n    </div>\r\n\r\n  );\r\n}\r\n\r\nexport default Chat;\r\n"]},"metadata":{},"sourceType":"module"}