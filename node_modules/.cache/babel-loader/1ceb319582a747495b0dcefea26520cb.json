{"ast":null,"code":"import { database, database_set, database_ref, database_on_value } from \"../services/firebase\";\nimport { onChildAdded, off, offChildAdded, onValue, query, orderByKey, orderByChild, limitToLast, startAt } from \"firebase/database\";\nexport function getRooms(callback) {\n  const roomRef = database_ref(database, \"chats/rooms\");\n  onValue(roomRef, snapshot => {\n    callback(snapshot.val());\n  });\n}\nexport function getRoomsAuth(roomName, callback) {\n  const roomAuthRef = query(database_ref(database, 'chats/' + roomName + \"/members\"), limitToLast(10));\n  onValue(roomAuthRef, snapshot => {\n    callback(snapshot.val());\n  });\n}\nexport function sendChat(roomName, data) {\n  const date = new Date();\n  const today = date.getFullYear() + \"\" + (\"0\" + (date.getMonth() + 1)).slice(-2) + \"\" + (\"0\" + date.getDate()).slice(-2);\n  return database_set(database_ref(database, 'chats/' + roomName + \"/messages/\" + today + \"/\" + data.timestamp), {\n    message: data.message,\n    timestamp: data.timestamp,\n    email: data.email,\n    uid: data.uid\n  });\n}\nexport function getAddedChats(roomName, callback) {\n  const date = new Date();\n  const today = date.getFullYear() + \"\" + (\"0\" + (date.getMonth() + 1)).slice(-2) + \"\" + (\"0\" + date.getDate()).slice(-2);\n  ;\n  let chatList = [];\n  const chatRef = query(database_ref(database, 'chats/' + roomName + \"/messages/\" + today), limitToLast(10)); // const chatRef = database_ref(database, 'chats/'+roomName+\"/messages/\"+today).limitToLast(10);\n  // chatRef.on('child_added', snapshot => {\n  //   if(snapshot.val().hasOwnProperty(\"uid\")) {\n  //     chatList.push(snapshot.val());\n  //   }\n  //   callback(chatList);\n  // });\n\n  onChildAdded(chatRef, snapshot => {\n    if (snapshot.val().hasOwnProperty(\"uid\")) {\n      chatList.push(snapshot.val());\n    }\n\n    callback(chatList);\n  });\n  callback(chatList, true);\n}\nexport function offRef(roomName, callback) {\n  const date = new Date();\n  const today = date.getFullYear() + \"\" + (\"0\" + (date.getMonth() + 1)).slice(-2) + \"\" + (\"0\" + date.getDate()).slice(-2);\n  ;\n  let chatList = [];\n  const chatRef = database_ref(database, 'chats/' + roomName + \"/messages/\" + today); // offChildAdded(chatRef, )\n\n  chatRef.off('child_added');\n}\n/*\r\nexport function getChats(roomName, callback) {\r\n  let chatList = [];\r\n  const date = new Date();\r\n  const today = (new Date(date.getFullYear(), date.getMonth(), date.getDate(), 0, 0, 0, 0)).getTime();\r\n  const chatRef = query(database_ref(database, 'chats/'+roomName), orderByKey(), startAt(today.toString()), limitToLast(10));\r\n  const chatRef2 = database_ref(database);\r\n  get(child(chatRef2, 'chats/'+roomName), limitToLast(10)).then((snapshot) => {\r\n    snapshot.forEach((row) => {\r\n      chatList.push(row.val());\r\n    });\r\n  },[]);\r\n  callback(chatList);\r\n}\r\n*/","map":{"version":3,"sources":["C:/workspaces/atom_workspace/sesh-chatchat/src/helpers/database.js"],"names":["database","database_set","database_ref","database_on_value","onChildAdded","off","offChildAdded","onValue","query","orderByKey","orderByChild","limitToLast","startAt","getRooms","callback","roomRef","snapshot","val","getRoomsAuth","roomName","roomAuthRef","sendChat","data","date","Date","today","getFullYear","getMonth","slice","getDate","timestamp","message","email","uid","getAddedChats","chatList","chatRef","hasOwnProperty","push","offRef"],"mappings":"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","sourcesContent":["import { database, database_set, database_ref, database_on_value } from \"../services/firebase\";\r\nimport { onChildAdded, off, offChildAdded, onValue, query, orderByKey, orderByChild, limitToLast, startAt } from \"firebase/database\";\r\n\r\nexport function getRooms(callback) {\r\n  const roomRef = database_ref(database, \"chats/rooms\");\r\n  onValue(roomRef, (snapshot) => {\r\n    callback(snapshot.val());\r\n  });\r\n}\r\n\r\nexport function getRoomsAuth(roomName, callback) {\r\n  const roomAuthRef = query(database_ref(database, 'chats/'+roomName+\"/members\"), limitToLast(10));\r\n  onValue(roomAuthRef, (snapshot) => {\r\n    callback(snapshot.val());\r\n  });\r\n}\r\n\r\nexport function sendChat(roomName, data) {\r\n  const date = new Date();\r\n  const today = date.getFullYear()+\"\"+(\"0\" + (date.getMonth() + 1)).slice(-2)+\"\"+(\"0\" + date.getDate()).slice(-2);\r\n  return database_set(database_ref(database, 'chats/'+roomName+\"/messages/\"+today+\"/\"+data.timestamp), {\r\n    message: data.message,\r\n    timestamp: data.timestamp,\r\n    email: data.email,\r\n    uid: data.uid\r\n  });\r\n}\r\n\r\nexport function getAddedChats(roomName, callback) {\r\n  const date = new Date();\r\n  const today = date.getFullYear()+\"\"+(\"0\" + (date.getMonth() + 1)).slice(-2)+\"\"+(\"0\" + date.getDate()).slice(-2);;\r\n  let chatList = [];\r\n  const chatRef = query(database_ref(database, 'chats/'+roomName+\"/messages/\"+today), limitToLast(10));\r\n  // const chatRef = database_ref(database, 'chats/'+roomName+\"/messages/\"+today).limitToLast(10);\r\n  // chatRef.on('child_added', snapshot => {\r\n  //   if(snapshot.val().hasOwnProperty(\"uid\")) {\r\n  //     chatList.push(snapshot.val());\r\n  //   }\r\n  //   callback(chatList);\r\n  // });\r\n  onChildAdded(chatRef, (snapshot) => {\r\n    if(snapshot.val().hasOwnProperty(\"uid\")) {\r\n      chatList.push(snapshot.val());\r\n    }\r\n    callback(chatList);\r\n  });\r\n  callback(chatList, true);\r\n}\r\n\r\nexport function offRef(roomName, callback) {\r\n  const date = new Date();\r\n  const today = date.getFullYear()+\"\"+(\"0\" + (date.getMonth() + 1)).slice(-2)+\"\"+(\"0\" + date.getDate()).slice(-2);;\r\n  let chatList = [];\r\n  const chatRef = database_ref(database, 'chats/'+roomName+\"/messages/\"+today);\r\n  // offChildAdded(chatRef, )\r\n  chatRef.off('child_added');\r\n}\r\n\r\n/*\r\nexport function getChats(roomName, callback) {\r\n  let chatList = [];\r\n  const date = new Date();\r\n  const today = (new Date(date.getFullYear(), date.getMonth(), date.getDate(), 0, 0, 0, 0)).getTime();\r\n  const chatRef = query(database_ref(database, 'chats/'+roomName), orderByKey(), startAt(today.toString()), limitToLast(10));\r\n  const chatRef2 = database_ref(database);\r\n  get(child(chatRef2, 'chats/'+roomName), limitToLast(10)).then((snapshot) => {\r\n    snapshot.forEach((row) => {\r\n      chatList.push(row.val());\r\n    });\r\n  },[]);\r\n  callback(chatList);\r\n}\r\n*/\r\n"]},"metadata":{},"sourceType":"module"}