{"ast":null,"code":"import _asyncToGenerator from\"C:/workspaces/atom_workspace/sesh-chatchat/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/workspaces/atom_workspace/sesh-chatchat/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\workspaces\\\\atom_workspace\\\\sesh-chatchat\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import{useState,useEffect}from\"react\";import{useNavigate}from\"react-router-dom\";import{getRoomsInfo,getRoomsAuth,getCommonInfo,setCommonInfo}from\"../helpers/database\";import{authService}from\"../services/firebase\";import{logout}from\"../helpers/auth\";import useNotification from\"../helpers/useNotification\";import\"../rooms.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Room(){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),roomList=_useState2[0],setRoomList=_useState2[1];var navigate=useNavigate();var isMount=true;var selectedRoom=\"\";var checkRooms={};var getRoomList=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var callback,notiCallback;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:callback=function callback(rooms){Object.keys(rooms).forEach(function(roomName,index){return getRoomsAuth(roomName,function(res){if(Object.keys(res).includes(authService.currentUser.uid)){checkRooms[roomName]=rooms[roomName];}if(index+1==Object.keys(rooms).length){var myList=function myList(){var list=Object.keys(checkRooms).map(function(roomName,index){return/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(\"button\",{className:\"room\",type:\"button\",onClick:handleSelectRoom,value:roomName,children:/*#__PURE__*/_jsx(\"span\",{children:roomName})},createItem(index+\"room\"))},createItem(index+\"li\"));});return/*#__PURE__*/_jsx(\"ul\",{children:list});};setRoomList(myList);}});});};notiCallback=function notiCallback(roomName,chatInfo){getRoomsAuth(roomName,function(res){if(Object.keys(res).includes(authService.currentUser.uid)){var _selectedRoom=getCommonInfo(\"selectedRoom\");if(chatInfo.date>Date.now()&&(isMount||!isMount&&_selectedRoom!=roomName)){notify(roomName,chatInfo.uid);}}});};getRoomsInfo(callback,notiCallback);case 3:case\"end\":return _context.stop();}}},_callee);}));return function getRoomList(){return _ref.apply(this,arguments);};}();var notify=function notify(roomName,uid){if(uid!==authService.currentUser.uid){useNotification('SESH',{body:\"from '\"+roomName+\"''\"});}};// USE EFFECT  ---------------------------------------\nuseEffect(function(){getRoomList();setCommonInfo(\"selectedRoom\",\"\");return function(){isMount=false;};},[]);// HANDLE  -------------------------------------------\nvar handleSelectRoom=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var roomName;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:e.preventDefault();roomName=e.target.value;if(roomName==undefined||roomName==\"undefined\"){alert(\"방을 다시 선택해주세요\");}else{getRoomsAuth(roomName,function(res){if(Object.keys(res).includes(authService.currentUser.uid)){console.log(\"[\"+roomName+\"] 입장\");setCommonInfo(\"selectedRoom\",roomName);navigate(\"/chat?room=\".concat(roomName));}else{alert(\"'\"+roomName+\"' 방 입장권한이 없습니다.\");}});}case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function handleSelectRoom(_x){return _ref2.apply(this,arguments);};}();var handleGoogleLogOut=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return logout();case 3:_context3.next=8;break;case 5:_context3.prev=5;_context3.t0=_context3[\"catch\"](0);console.log(_context3.t0);case 8:case\"end\":return _context3.stop();}}},_callee3,null,[[0,5]]);}));return function handleGoogleLogOut(){return _ref3.apply(this,arguments);};}();// ETC ----------------------------------------------\nvar itemId=1;var createItem=function createItem(text){return itemId++ +text;};// --------------------------------------------------\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"room-wrap\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"logout-room\",type:\"button\",onClick:handleGoogleLogOut,children:\"LOGOUT\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"div\",{children:roomList})]});}export default Room;","map":{"version":3,"sources":["C:/workspaces/atom_workspace/sesh-chatchat/src/pages/Room.js"],"names":["useState","useEffect","useNavigate","getRoomsInfo","getRoomsAuth","getCommonInfo","setCommonInfo","authService","logout","useNotification","Room","roomList","setRoomList","navigate","isMount","selectedRoom","checkRooms","getRoomList","callback","rooms","Object","keys","forEach","roomName","index","res","includes","currentUser","uid","length","myList","list","map","handleSelectRoom","createItem","notiCallback","chatInfo","date","Date","now","notify","body","e","preventDefault","target","value","undefined","alert","console","log","handleGoogleLogOut","itemId","text"],"mappings":"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","sourcesContent":["import { useState, useEffect } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { getRoomsInfo, getRoomsAuth, getCommonInfo, setCommonInfo } from \"../helpers/database\";\r\nimport { authService } from \"../services/firebase\";\r\nimport { logout } from \"../helpers/auth\";\r\nimport useNotification from \"../helpers/useNotification\";\r\nimport \"../rooms.css\"\r\n\r\nfunction Room() {\r\n\r\n  const [roomList, setRoomList] = useState(\"\");\r\n  let navigate = useNavigate();\r\n  let isMount = true;\r\n  let selectedRoom = \"\";\r\n  let checkRooms = {};\r\n\r\n  const getRoomList = async() => {\r\n\r\n    const callback = (rooms) => {\r\n\r\n      Object.keys(rooms).forEach((roomName, index) => (\r\n        getRoomsAuth(roomName, function(res) {\r\n          if(Object.keys(res).includes(authService.currentUser.uid)) {\r\n            checkRooms[roomName] = rooms[roomName]\r\n          }\r\n \r\n          if(index+1 == Object.keys(rooms).length) {\r\n            const myList = () => {\r\n              const list = Object.keys(checkRooms).map((roomName, index) => (\r\n                <li key={createItem(index+\"li\")}>\r\n                  <button\r\n                    key={createItem(index+\"room\")}\r\n                    className = \"room\"\r\n                    type=\"button\"\r\n                    onClick={handleSelectRoom}\r\n                    value={roomName}>\r\n                    <span>{roomName}</span>\r\n                  </button>\r\n                </li>\r\n              ));\r\n              return <ul>{list}</ul>;\r\n            };\r\n\r\n            setRoomList(myList);\r\n          }\r\n        })\r\n      ));\r\n\r\n    }\r\n\r\n    const notiCallback = (roomName, chatInfo) => {\r\n      getRoomsAuth(roomName, function(res) {\r\n        if(Object.keys(res).includes(authService.currentUser.uid)) {\r\n          const selectedRoom = getCommonInfo(\"selectedRoom\");\r\n          if(chatInfo.date > Date.now()\r\n                && (isMount || (!isMount && selectedRoom != roomName))) {\r\n            notify(roomName, chatInfo.uid);\r\n          }\r\n        }\r\n      })\r\n    }\r\n\r\n    getRoomsInfo(callback, notiCallback);\r\n\r\n  };\r\n\r\n  const notify = (roomName, uid) => {\r\n    if(uid !== authService.currentUser.uid) {\r\n      useNotification('SESH', {\r\n        body: \"from '\"+roomName+\"''\"\r\n      });\r\n    }\r\n  }\r\n\r\n\r\n// USE EFFECT  ---------------------------------------\r\n  useEffect(() => {\r\n    getRoomList();\r\n    setCommonInfo(\"selectedRoom\", \"\");\r\n    return() => {\r\n      isMount = false;\r\n    }\r\n  }, []);\r\n\r\n\r\n// HANDLE  -------------------------------------------\r\n  const handleSelectRoom = async (e) => {\r\n    e.preventDefault();\r\n    const roomName = e.target.value;\r\n    if(roomName == undefined || roomName == \"undefined\") {\r\n      alert(\"방을 다시 선택해주세요\");\r\n    }else {\r\n      getRoomsAuth(roomName, function(res) {\r\n        if(Object.keys(res).includes(authService.currentUser.uid)) {\r\n          console.log(\"[\"+roomName+\"] 입장\")\r\n          setCommonInfo(\"selectedRoom\", roomName);\r\n          navigate(`/chat?room=${roomName}`);\r\n        }else {\r\n          alert(\"'\"+roomName+\"' 방 입장권한이 없습니다.\")\r\n        }\r\n      })\r\n    }\r\n  };\r\n\r\n  const handleGoogleLogOut = async () => {\r\n    try {\r\n      await logout();\r\n    } catch (error) {\r\n     console.log(error);\r\n    }\r\n  };\r\n\r\n\r\n// ETC ----------------------------------------------\r\n  let itemId = 1;\r\n  const createItem = (text) => {\r\n    return (itemId++) + text;\r\n  }\r\n// --------------------------------------------------\r\n\r\n\r\n  return (\r\n    <div className=\"room-wrap\">\r\n      <button\r\n        className=\"logout-room\"\r\n        type=\"button\"\r\n        onClick={handleGoogleLogOut}>\r\n        LOGOUT\r\n      </button>\r\n      <br/><br/>\r\n      <div>\r\n        {roomList}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Room;\r\n"]},"metadata":{},"sourceType":"module"}